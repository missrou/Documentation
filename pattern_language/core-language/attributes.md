# 属性

属性是特殊指令，可为单个变量和类型添加额外配置。

```rust
struct RGBA8 {
  u8 red   [[color("FF0000")]];
  u8 green [[color("00FF00")]];
  u8 blue  [[color("0000FF")]];
} [[static, color(std::format("{:02X}{:02X}{:02X}", red, green, blue))]];
```

{% hint style="info" %}
属性可以不带参数: `[[attribute_name]]`或一个或多个参数: `[[attribute_name("arg1", 1234)]]`
{% endhint %}

同样可以为同一个变量或类型应用多个属性。: `[[attribute1, attribute2(1234)]]`

### 可变属性

{% hint style="info" %}
可变属性也可直接应用于类型，从而使从该类型派生出的所有模式均继承这些属性。

要访问变量所应用属性的成员，请使用 `this` 关键字。某些属性允许将可选模式作为参数。若无需指定模式，可使用 `null` 关键字替代。
{% endhint %}

#### `[[color("RRGGBB")]]`

更改十六进制编辑器中突出显示变量的颜色。

#### `[[name("new_name")]]`

在模式数据视图中更改变量的显示名称，同时不影响程序的其余部分。

#### `[[comment("text")]]`

在模式数据视图中，将当前变量悬停时显示的注释添加至该变量。

#### `[[format("formatter_function_name")]]` / `[[format_read("formatter_function_name")]]`

使用自定义函数覆盖默认显示值格式化器。该函数需要一个参数，该参数代表待格式化的值（例如，若此属性应用于类型为`u32`的变量，则参数为`u32`），并返回一个字符串，该字符串将替代默认值进行显示。

该函数还可返回模式或值，这些内容将根据默认模式语言规则进行默认格式化。

#### `[[format_write("formatter_function_name")]]`

允许为类型指定自定义写入格式化函数。该函数接收用户提供的字符串输入，并返回任何可转换为字节并写入该模式地址的模式。

#### `[[format_entries("formatter_function_name")]]` / `[[format_read_entries("formatter_function_name")]]`

可应用于数组，其作用与`[[format_read]]`属性相同，但会覆盖所有数组条目的默认显示值格式化器，而非仅覆盖数组模式本身。

#### `[[format_write_entries("formatter_function_name")]]`

可应用于数组，其作用与`[[format_write]]`属性相同，但会覆盖所有数组条目的默认值写入格式器，而非仅覆盖数组模式本身。

#### `[[hidden]]`

防止变量在模式数据视图中显示，但仍可在程序的其余部分使用。

#### `[[inline]]`

仅适用于数组和结构体类型的变量。将该变量的所有成员可视化地内联到父作用域中。此操作有助于展平显示的树形结构，避免不必要的缩进，同时保持模式的结构化。

#### `[[transform("transformer_function_name")]]`

指定一个函数，用于在通过点语法（`some_struct.some_value`）访问该变量之前，对从该变量读取的值进行预处理。该函数需要一个参数，该参数代表原始读取的值（例如，如果此属性应用于类型为`u32`的变量，则为`u32`），并返回一个将被替换返回的值。

#### `[[transform_entries("transformer_function_name")]]`

可应用于数组，其作用与`[[transform]]`属性相同，但会覆盖数组中所有条目的转换函数，而非仅覆盖数组模式本身。

#### `[[pointer_base("pointer_base_function_name")]]`

指定一个用于预处理应用此属性的指针地址的函数。该函数需要一个参数，该参数表示读取到的原始指针地址（例如，如果此属性应用于大小类型为`u32`的指针，则为`u32`），并返回指针应指向的新偏移量。

标准库（`std::ptr`）中提供了一系列预定义的指针辅助函数，用于将指针重新定位到不同位置。

#### `[[no_unique_address]]`

标记此属性的变量将被放置在内存中，但不会递增当前光标位置。

#### `[[single_color]]`

强制结构体、联合体或数组的所有成员使用相同颜色高亮显示，而非各自单独高亮。

### Type Attributes

#### `[[static]]`

模式语言默认会优化内置类型的数组，使其占用更少的内存并加快评估速度。

同样的优化也可应用于自定义数据类型，当它们被标记此属性时，可告知运行时该类型的大小和布局始终保持不变。

**注意** 如果应用此类型的布局不是静态的，或者你在其中使用了函数或函数语句（如局部变量），数据的高亮显示和解码将会出错！该行为未定义且可能随版本变更，请勿依赖此功能！

#### `[[bitfield_order(ordering, size)]]`

此属性会改变所应用位域内字段的排序和对齐方式。

`排序方式`可以是`std::core::BitfieldOrder::LeastToMostSignificant`或`std::core::BitfieldOrder::MostToLeastSignificant`。默认情况下，若未设置自定义位域排序，当位域采用小端序时，字段按从低位到高位排序；若采用大端序，则按从高位到低位排序。

使用从最高有效位到最低有效位的方式，还要求您指定位域的完整大小，以便运行时知道从何处开始放置字段。

#### `[[sealed]]`

此属性可应用于结构体、联合体和位域。它会使以某种方式显示模式的工具不再显示实现细节（例如该类型的子类型），而是将其视为内置类型。这主要适用于创建自定义类型，这些类型应使用`[[format]]`属性以自定义格式解码并显示字节。

#### `[[highlight_hidden]]`

与`[[hidden]]`属性功能相同，但仅隐藏变量的高亮显示，不会在模式数据视图中隐藏该变量。

#### `[[export]]`

此属性允许导出模式局部变量。默认情况下，模式局部变量不会出现在输出中，仅用于在模式内存储临时值。为某个变量添加此属性后，它将像常规变量一样出现在输出中。

如果需要在输出前对值进行预处理，这将非常有用。

**`[[fixed_size(size)]]`**

可用于强制结构体具有特定大小。当应用于小于`size`的结构体时，会进行填充以精确达到该大小。若结构体原本大于该大小，则会抛出错误。
